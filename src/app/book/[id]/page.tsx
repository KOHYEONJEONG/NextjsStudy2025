import { notFound } from "next/navigation";
import style from "./page.module.css";
import { Metadata } from "next";

const mockData = {
  id: 1,
  title: "í•œ ì… í¬ê¸°ë¡œ ì˜ë¼ ë¨¹ëŠ” ë¦¬ì•¡íŠ¸",
  subTitle: "ìë°”ìŠ¤í¬ë¦½íŠ¸ ê¸°ì´ˆë¶€í„° ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬ê¹Œì§€",
  description:
    "ìë°”ìŠ¤í¬ë¦½íŠ¸ ê¸°ì´ˆë¶€í„° ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬ê¹Œì§€\nì²˜ìŒ ì‹œì‘í•˜ê¸° ë”± ì¢‹ì€ ë¦¬ì•¡íŠ¸ ì…ë¬¸ì„œ\n\nì´ ì±…ì€ ì›¹ ê°œë°œì—ì„œ ê°€ì¥ ë§ì´ ì‚¬ìš©í•˜ëŠ” í”„ë ˆì„ì›Œí¬ì¸ ë¦¬ì•¡íŠ¸ ì‚¬ìš© ë°©ë²•ì„ ì†Œê°œí•©ë‹ˆë‹¤. ì¸í”„ëŸ°, ìœ ë°ë¯¸ì—ì„œ 5000ì—¬ ëª…ì´ ìˆ˜ê°•í•œ ë² ìŠ¤íŠ¸ ê°•ì¢Œë¥¼ ì±…ìœ¼ë¡œ ì—®ì—ˆìŠµë‹ˆë‹¤. í”„ëŸ°íŠ¸ì—”ë“œ ê°œë°œì„ í¬ë§í•˜ëŠ” ì‚¬ëŒë“¤ì„ ìœ„í•´ ë¦¬ì•¡íŠ¸ì˜ ê¸°ë³¸ì„ ìµíˆê³  ë‹¤ì–‘í•œ ì•±ì„ êµ¬í˜„í•˜ëŠ” ë° ë¶€ì¡±í•¨ì´ ì—†ë„ë¡ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤. \n\nìë°”ìŠ¤í¬ë¦½íŠ¸ ê¸°ì´ˆ ì§€ì‹ì´ ë¶€ì¡±í•´ ë¦¬ì•¡íŠ¸ ê³µë¶€ë¥¼ ë§ì„¤ì´ëŠ” ë¶„, í”„ëŸ°íŠ¸ì—”ë“œ ê°œë°œì„ í¬ë§í•˜ëŠ” ì·¨ì¤€ìƒìœ¼ë¡œ ë¦¬ì•¡íŠ¸ê°€ ì²˜ìŒì¸ ë¶„, í¼ë¸”ë¦¬ì…”ë‚˜ ë°±ì—”ë“œì—ì„œ í”„ëŸ°íŠ¸ì—”ë“œë¡œ ì§êµ° ì „í™˜ì„ ê¾€í•˜ê±°ë‚˜ ì—…ë¬´ìƒ ë¦¬ì•¡íŠ¸ê°€ í•„ìš”í•œ ë¶„, ë·°, ìŠ¤ë²¨íŠ¸ ë“± ë‹¤ë¥¸ í”„ë ˆì„ì›Œí¬ë¥¼ ì“°ê³  ìˆëŠ”ë°, ì‹¤ìš©ì ì¸ ë¦¬ì•¡íŠ¸ë¥¼ ë°°ìš°ê³  ì‹¶ì€ ë¶„, ì‹ ì… ê°œë°œìì´ì§€ë§Œ ìë°”ìŠ¤í¬ë¦½íŠ¸ë‚˜ ë¦¬ì•¡íŠ¸ ê¸°ì´ˆê°€ ë¶€ì¡±í•œ ë¶„ì—ê²Œ ìœ ìš©í•  ê²ƒì…ë‹ˆë‹¤.",
  author: "ì´ì •í™˜",
  publisher: "í”„ë¡œê·¸ë˜ë°ì¸ì‚¬ì´íŠ¸",
  coverImgUrl:
    "https://shopping-phinf.pstatic.net/main_3888828/38888282618.20230913071643.jpg",
};

// book\[id]
// í•œê°œì˜ url íŒŒë¼ë¯¸í„°ë§Œ í—ˆìš©í•œë‹¤.(ex) book\1\2 ì€ ì•ˆëœë‹¤!)
// http://localhost:3000/book/1

//[...id]ì´ë©´ í•œê°œì´ìƒì˜ íŒŒë¼ë¯¸í„°ë„ í—ˆìš©í•œë‹¤.
// ex( ttp://localhost:3000/book/1/2)
// ë‹¨ url íŒŒë¼ë¯¸í„°ê°€ í•œê°œë„ ì—†ìœ¼ë©´ 404 ì—ëŸ¬
// *[[...id]] ì´ë ‡ê²Œ ì‚¬ìš©í•˜ë©´ ì—†ì–´ë„ ì—ëŸ¬ ì•ˆë‚¨

//â¬generateStaticParamsë¡œ ë‚´ë³´ë‚´ì§„ url íŒŒë¼ë¯¸í„°ê°€ [{ id: "1" }, { id: "2" }, { id: "3" }]; ì´ì™¸ì—ëŠ” ì¡´ì¬í•˜ì§€ ë§ì•„ì•¼í•  ë•Œ 404í˜ì´ì§€ë¡œ ë³´ë‚´ê³  ì‹¶ë‹¤ë©´? ì•„ë˜ í•œì¤„ ì ê¸°
//export const dynamicParams = false;//ğŸ”¥ë„¥ìŠ¤íŠ¸ ì„œë²„ê°€ ìë™ìœ¼ë¡œ ì´ í˜ì´ì§€ë¥¼ ìƒì„±í•  ë•Œ dynamicParams ë³€ìˆ˜ì˜ ê°’ì„ ë‚´ë³´ë‚´ì§„ ê°’ì„ í™•ì¸í•˜ì—¬ ë„¥ìŠ¤íŠ¸ëŠ” ì´ í˜ì´ì§€ì˜ 'íŒŒë¼ë¯¸í„°'ëŠ” ë‹¤ì´ë‚˜ë¯¹í•˜ë©´ ì•ˆë˜êµ¬ë‚˜ ìƒê°í•œë‹¤.
//                            ê¸°ë³¸ê°’ì´ trueì´ê³ , trueë©´ ì‘ì„± ì•ˆí•˜ë©´ ë¨.

/*
  # generateStaticParams í•¨ìˆ˜
  - ì •ì ìœ¼ë¡œ ë¹Œë“œ íƒ€ì„ì— ì–´ë– í•œ url íŒŒë¼ë¯¸í„°ê°€ ì¡´ì¬í•  ìˆ˜ ìˆëŠ”ì§€
  - ğŸ”¥ì–´ë–¤ ë„ì„œê°€ ë¹Œë“œíƒ€ì„ì— ë§Œë“¤ì–´ì ¸ì•¼ ë˜ëŠ”ì§€ ë¨¼ì € 
*/
export function generateStaticParams() {
  // ğŸ”¥ë„¥ìŠ¤íŠ¸ ì„œë²„ê°€ ìë™ìœ¼ë¡œ ì´ ì •ì  íŒŒë¼ë¯¸í„°ë¥¼ ì½ì–´ì„œ ì´ íŒŒë¼ë¯¸í„°ì— í•´ë‹¹í•˜ëŠ” ë¶í˜ì´ì§€ë¥¼ ë¹Œë“œíƒ€ì„ì— ì •ì ìœ¼ë¡œ ë§Œë“ ë‹¤.
  //  ã„´ ğŸ”¥C:\Users\EM_NB163\OneDrive\ë¬¸ì„œ\onebite-next\section03\.next\server\app\book í´ë”ì— 1,2,3 í˜ì´ì§€ê°€ ë§Œë“¤ì–´ì§„ê±¸ ë³¼ ìˆ˜ ìˆë‹¤(ë˜ëŠ” npm run build ì½˜ì†”ì°½ì— ì¶œë ¥.)
  //  ã„´ â­ì„œë²„ì¸¡ì— 'í’€ ë¼ìš°íŠ¸ ìºì‹œ'ë¡œ ì˜ ë³´ê´€ëœê±¸ ì•Œ ìˆ˜ ìˆë‹¤.
  // ì •ì  í˜ì´ì§€ë¡œ ë³€ê²½í•˜ê¸° ìœ„í•´ì„œ ì‚¬ìš©, ì†ë„ í–¥ìƒ
  // (ğŸ”¥ì´ ì™¸ í˜ì´ì§€ëŠ” ì…ë ¥ ì•ˆí•´ë„ ì›ë˜ëŠ” ë™ì  í˜ì´ì§€ë‹ˆê¹Œ ì‹¤ì‹œê°„ìœ¼ë¡œ ê²€ìƒ‰ë˜ì„œ ì˜ ë‚˜ì˜´.
  // ã„´ì´ë•Œ í•´ë‹¹í˜ì´ì§€ë„ í’€ ë¼ìš°íŠ¸ ìºì‹œë¡œì¨ ì˜ ì €ì¥ì´ ë˜ê³ ìˆë‹¤!!!! - í•´ë‹¹ í˜ì´ì§€ ë‹¤ì‹œ ì ‘ì†í•´ë„ ë¹ ë¥´ê²Œ ì €ì¥ëœ í˜ì´ì§€ë¥¼ ë³´ì—¬ì¤€ë‹¤.)
  // ã„´ã„´ http://localhost:3000/book/10
  // ã„´ã„´ã„´ğŸ”¥ë¶ˆëŸ¬ì˜¨ í•´ë‹¹ í˜ì´ì§€ë¥¼ ë‹¤ì‹œ ìƒˆë¡œê³ ì¹¨í•´ë³´ë©´ ex 65ms -> 9ms ë°–ì— ì•ˆê±¸ë¦°ë‹¤.
  // ã„´ã„´ã„´ã„´ã„´ í•œë²ˆ ìš”ì²­ëœ í˜ì´ì§€ëŠ” ìƒˆë¡­ê²Œ ìš”ì²­í•´ë„ ìƒì„±ë˜ì§€ ì•ŠëŠ”ë‹¤. ì™œ? í’€ë¼ìš°íŠ¸ ìºì‹œì— ì €ì¥ë˜ì–´ì„œ (ì²˜ìŒë³´ë‹¤ ë¹ ë¥´ê²Œ ë³´ì—¬ì§„ë‹¤.)

  return [{ id: "1" }, { id: "2" }, { id: "3" }];
  // ì£¼ì˜í•  ì : ìœ„ì—ì²˜ëŸ¼ URL íŒŒë¼ë¯¸í„°ì˜ ê°’ì„ ëª…ì‹œí•  ë•Œì—ëŠ” ë¬¸ìì—´ë¡œë§Œ, ë¬¸ìì—´ ë°ì´í„°ë¡œë§Œ ëª…ì‹œí•´ì•¼ í•œë‹¤.
  // ğŸ”¥ì´ì œ í•´ë‹¹ í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸ëŠ” ìŠ¤íƒœí‹± í˜ì´ì§€ì´ë‹¤. ë°‘ì— ë™ì í•¨ìˆ˜(fetch ë° ìºì‹œ ì‚¬ìš© ì•ˆí•œ í•¨ìˆ˜)ì‚¬ìš©í–ˆì§€ë§Œ ê°•ì œë¡œ ìŠ¤íƒœí‹± í˜ì´ì§€ë¡œ ì„¤ì •ëœë‹¤.
}

export async function generateMetadata({
  params,
}: {
  params: Promise<{ id: string | string[] }>;
}) {
  const { id } = await params;
  const response = await fetch(
    `${process.env.NEXT_PUBLIC_API_SERVER_URL}/book/${id}`,
    { cache: "force-cache" }
  );
  return {
    //
  };
}

export default async function Page({
  params,
}: {
  params: Promise<{ id: string | string[] }>;
}) {
  const response = await fetch(
    // `${process.env.NEXT_PUBLIC_API_SERVER_URL}/book/${(await params).id}`
    `${process.env.NEXT_PUBLIC_API_SERVER_URL}/book/${(await params).id}`
  );
  //ì˜ˆì™¸ì²˜ë¦¬ í•„ìˆ˜
  if (!response.ok) {
    //ì‚¬ì‹¤ìƒ ë³´ê¸°ì—ëŠ” ì•ˆ ì¢‹ìŒ. ë°ì´í„°ê°€ ì—†ë‹¤ë©´ 404 í˜ì´ì§€ë¥¼ ë³´ì—¬ì£¼ëŠ”ê²Œ í›¨ì”¬ ì¢‹ìŒ.
    if (response.status === 404) {
      //ë°±ì—”ë“œ ì„œë²„ë¡œë¶€í„° ë°ì´í„°ê°€ í˜„ì¬ ì—†ë‹¤ëŠ” ê±°ë‹ˆê¹Œ notFoundí•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì.
      notFound(); //next/navigation
    }
    return <div>ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤...</div>;
  }

  const book = await response.json();

  //í•˜ë‚˜ì˜ ë„ì„œì˜ ë°ì´í„°ë¥¼ ê°ì²´í˜•íƒœë¡œ ë³´ê´€
  const { id, title, subTitle, description, author, publisher, coverImgUrl } =
    book;

  return (
    <div className={style.container}>
      <div
        className={style.cover_img_container}
        style={{ backgroundImage: `url('${coverImgUrl}')` }}
      >
        {/* ë„ì„œ ì»¤ë²„ ì´ë¯¸ì§€ */}
        <img src={coverImgUrl} />
      </div>
      <div className={style.title}>{title}</div>
      <div className={style.subTitle}>{subTitle}</div>
      <div className={style.author}>
        {author} | {publisher}
      </div>
      <div className={style.description}>{description}</div>
    </div>
  );
}
